var astar={init:function(c){for(var b=0,a=c.length;b<a;b++)for(var e=0,f=c[b].length;e<f;e++){var d=c[b][e];d.f=0;d.g=0;d.h=0;d.cost=d.type;d.visited=!1;d.closed=!1;d.parent=null}},heap:function(){return new BinaryHeap(function(c){return c.f})},search:function(c,b,a,e,f){astar.init(c);f=f||astar.manhattan;e=!!e;var d=astar.heap();for(d.push(b);0<d.size();){b=d.pop();if(b===a){c=b;for(a=[];c.parent;)a.push(c),c=c.parent;return a.reverse()}b.closed=!0;for(var h=astar.neighbors(c,b,e),l=0,g=h.length;l<
g;l++){var j=h[l];if(!j.closed&&!j.isWall()){var k=b.g+j.cost,n=j.visited;if(!n||k<j.g)j.visited=!0,j.parent=b,j.h=j.h||f(j.pos,a.pos),j.g=k,j.f=j.g+j.h,n?d.rescoreElement(j):d.push(j)}}}return[]},manhattan:function(c,b){var a=Math.abs(b.x-c.x),e=Math.abs(b.y-c.y);return a+e},neighbors:function(c,b,a){var e=[],f=b.x;b=b.y;c[f-1]&&c[f-1][b]&&e.push(c[f-1][b]);c[f+1]&&c[f+1][b]&&e.push(c[f+1][b]);c[f]&&c[f][b-1]&&e.push(c[f][b-1]);c[f]&&c[f][b+1]&&e.push(c[f][b+1]);a&&(c[f-1]&&c[f-1][b-1]&&e.push(c[f-
1][b-1]),c[f+1]&&c[f+1][b-1]&&e.push(c[f+1][b-1]),c[f-1]&&c[f-1][b+1]&&e.push(c[f-1][b+1]),c[f+1]&&c[f+1][b+1]&&e.push(c[f+1][b+1]));return e}};var GraphNodeType={OPEN:1,WALL:0};function Graph(c){for(var b=[],a=0;a<c.length;a++){b[a]=[];for(var e=0,f=c[a];e<f.length;e++)b[a][e]=new GraphNode(a,e,f[e])}this.input=c;this.nodes=b}Graph.prototype.destroy=function(){delete this.input;delete this.nodes};Graph.prototype.toString=function(){for(var c="\n",b=this.nodes,a,e,f,d,h=0,l=b.length;h<l;h++){a="";e=b[h];f=0;for(d=e.length;f<d;f++)a+=e[f].type+" ";c=c+a+"\n"}return c};
function GraphNode(c,b,a){this.data={};this.x=c;this.y=b;this.pos={x:c,y:b};this.type=a}GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(c){this.content=[];this.scoreFunction=c}
BinaryHeap.prototype={push:function(c){this.content.push(c);this.sinkDown(this.content.length-1)},pop:function(){var c=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return c},remove:function(c){var b=this.content.indexOf(c),a=this.content.pop();b!==this.content.length-1&&(this.content[b]=a,this.scoreFunction(a)<this.scoreFunction(c)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(c){this.sinkDown(this.content.indexOf(c))},
sinkDown:function(c){for(var b=this.content[c];0<c;){var a=(c+1>>1)-1,e=this.content[a];if(this.scoreFunction(b)<this.scoreFunction(e))this.content[a]=b,this.content[c]=e,c=a;else break}},bubbleUp:function(c){for(var b=this.content.length,a=this.content[c],e=this.scoreFunction(a);;){var f=c+1<<1,d=f-1,h=null;if(d<b){var l=this.scoreFunction(this.content[d]);l<e&&(h=d)}if(f<b&&this.scoreFunction(this.content[f])<(null===h?e:l))h=f;if(null!==h)this.content[c]=this.content[h],this.content[h]=a,c=h;else break}}};var boxledjs=boxledjs||{};
(function(c){Utils={getScreenWidth:function(){if("number"==typeof window.innerWidth)return window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))return document.documentElement.clientWidth;if(document.body&&(document.body.clientWidth||document.body.clientHeight))return document.body.clientWidth},getScreenHeight:function(){if("number"==typeof window.innerWidth)return window.innerHeight;if(document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight))return document.documentElement.clientHeight;if(document.body&&(document.body.clientHeight||document.body.clientHeight))return document.body.clientHeight},getStage:function(b){return b.canvas?b:b.parent?b.parent.canvas?b.parent:c.getStage(b.parent):null},getDefinitionByName:function(b,a,e){a=a||window;e=e||b;b=b.split(".");var f=b.shift();if(a=a[f])return b.length?c.getDefinitionByName(b.join("."),a,e):a;throw Error("Could not find '"+f+"' of '"+e+"'");},applyConstruct:function(b,
a){function e(){function a(){}a.prototype=b.prototype;return new a}var f,d;"function"===typeof Object.create?f=Object.create(b.prototype):{}.__proto__?(f={},f.__proto__=b.prototype,f.__proto__!==b.prototype&&(f=e())):f=e();f.constructor=b;d=b.apply(f,a);"object"===typeof d&&(f=d);return f}};c.Utils=Utils})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,e){a=a.split(",");return{x:parseFloat(a[0])*e.width,y:parseFloat(a[1])*e.height}}Box2DUtils={RECT:"rect",CIRCLE:"circle",makeB2DBodyFromData:function(a,e){boxledjs.Const.scale=boxledjs.Const.scale||32;var f=a.properties,d=new Box2D.Dynamics.b2FixtureDef;d.density=void 0==f.density?1:parseFloat(f.density);d.friction=void 0==f.friction?0.5:parseFloat(f.friction);d.restitution=void 0==f.restitution?0.05:parseFloat(f.restitution);d.isSensor=!Box2DUtils.isTileCollideable(f);var h=
new Box2D.Dynamics.b2BodyDef;h.type=f.dynamic?Box2D.Dynamics.b2Body.b2_dynamicBody:Box2D.Dynamics.b2Body.b2_staticBody;var h=e.CreateBody(h),l=a.width/boxledjs.Const.scale/2,g=a.height/boxledjs.Const.scale/2;if(f.topLeft||f.topRight||f.bottomRight||f.bottomLeft)a.polygon=[],"none"!=f.topLeft&&a.polygon.push(b(f.topLeft||"0,0",a)),"none"!=f.topRight&&a.polygon.push(b(f.topRight||"1,0",a)),"none"!=f.bottomRight&&a.polygon.push(b(f.bottomRight||"1,1",a)),"none"!=f.bottomLeft&&a.polygon.push(b(f.bottomLeft||
"0,1",a));if(!0==a.ellipse)d.shape=new Box2D.Collision.Shapes.b2CircleShape(l),h.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;else if(a.polygon&&1<a.polygon.length)Box2D.Ext.b2Separator.Separate(h,d,a.polygon,boxledjs.Const.scale);else if(a.polyline&&1<a.polyline.length)for(var j,l=0,g=a.polyline.length;l<g-1;l++)d.shape=new Box2D.Collision.Shapes.b2PolygonShape,j=a.polyline[l],f=new Box2D.Common.Math.b2Vec2(j.x/boxledjs.Const.scale,j.y/boxledjs.Const.scale),j=a.polyline[l+1],j=new Box2D.Common.Math.b2Vec2(j.x/
boxledjs.Const.scale,j.y/boxledjs.Const.scale),d.shape.SetAsEdge(f,j),h.CreateFixture(d);else d.shape=new Box2D.Collision.Shapes.b2PolygonShape,d.shape.SetAsBox(l,g),h.CreateFixture(d),a.x+=a.width/2,a.y+=a.height/2;h.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),(a.rotation||0)*Math.PI/180);h.SetUserData(a);return h},isTileCollideable:function(a,e){return 0!=e&&(!a||!(a.isSensor&&"false"!=a.isSensor||a.noCollision&&"false"!=a.noCollision||a.force||
a.forceX||a.forceY||void 0!=a.gravityFactor))},injectBox2d:function(a,e,f,d,h,b,g,j,c,n){void 0==j&&(j=!0);void 0==c&&(c=!1);n=n||"borders";var m=boxledjs.Const.scale=boxledjs.Const.scale||32;a.bxd=a.bxd||{};f*=0.5;d*=0.5;var p=new Box2D.Dynamics.b2FixtureDef;p.density=void 0==h?1:h;p.friction=void 0==b?0.5:b;p.restitution=void 0==g?0.05:g;p.isSensor=c;if(e==Box2DUtils.RECT){if(p.shape=new Box2D.Collision.Shapes.b2PolygonShape,p.shape.SetAsBox(f/m,d/m),!c){sensorsDef={};if("borders"==n||"both"==n)sensorsDef.bottom=
Box2DUtils.makeSensorDef((f+2)/m,2/m,0,d/m),sensorsDef.top=Box2DUtils.makeSensorDef((f+2)/m,2/m,0,-d/m),sensorsDef.right=Box2DUtils.makeSensorDef(2/m,(d-1)/m,f/m,0),sensorsDef.left=Box2DUtils.makeSensorDef(2/m,(d-1)/m,-f/m,0);if("corners"==n||"both"==n)sensorsDef.tr=Box2DUtils.makeSensorDef(2/m,2/m,(f+2)/m,-d/m),sensorsDef.br=Box2DUtils.makeSensorDef(2/m,2/m,(f+2)/m,(d+4)/m),sensorsDef.bl=Box2DUtils.makeSensorDef(2/m,2/m,-(f+2)/m,(d+4)/m),sensorsDef.tl=Box2DUtils.makeSensorDef(2/m,2/m,-(f+2)/m,-d/
m)}}else if(e==Box2DUtils.CIRCLE)p.shape=new Box2D.Collision.Shapes.b2CircleShape(2*f/m);else throw Error("Cannot resolve shape-type: "+e);a.bxd.fixDef=p;if(!c){a.bxd.sensors={bottom:[],top:[],right:[],left:[],tr:[],br:[],bl:[],tl:[]};a.bxd.sensorsDef=sensorsDef;var r=[];a.isSensor=function(a){if(!this.bxd||!this.bxd.sensors)return!1;a=this.bxd.sensors[a];if(!a)return!1;for(var e=0,f=a.length;e<f;++e){trigger=a[e];var d=trigger.GetUserData();d&&d.object&&(d=d.object);var h=d.ignoreCollisionsWith||
(d.properties&&d.properties.ignoreCollisionsWith?d.properties.ignoreCollisionsWith:r),b=this.ignoreCollisionsWith||(this.properties&&this.properties.ignoreCollisionsWith?this.properties.ignoreCollisionsWith:r),h=0<=h.indexOf(this.subType)||0<=h.indexOf(this.type),b=0<=b.indexOf(d.subType)||0<=b.indexOf(d.type);if(!h&&!b&&!(!1==this.visible||!1==d.visible))return!0}return!1}}e=new Box2D.Dynamics.b2BodyDef;e.type=!j?Box2D.Dynamics.b2Body.b2_staticBody:Box2D.Dynamics.b2Body.b2_dynamicBody;a.bxd.bodyDef=
e;Box2DUtils.injectOnTick(a)},injectOnTick:function(a){a.onTick&&(a.__onTick=a.onTick);a.onTick=function(a){this.__onTick&&this.__onTick(a);if(this.bxd.body){a=this.bxd.body.GetPosition();if(-5E4>=a.x||-5E4>=a.y){var f=this;f.hideTO=setTimeout(function(){f.visible=!1},50)}else this.hideTO&&(clearTimeout(this.hideTO),delete this.hideTO),this.visible=!0;this.x=a.x*(boxledjs.Const.scale||32);this.y=a.y*(boxledjs.Const.scale||32);this.rotation=180*(this.bxd.body.GetAngle()/Math.PI)}}},makeSensorDef:function(a,
e,f,d){var h=new Box2D.Dynamics.b2FixtureDef;h.isSensor=!0;var b=new Box2D.Collision.Shapes.b2PolygonShape;b.SetAsOrientedBox(a,e,new Box2D.Common.Math.b2Vec2(f,d),0);h.shape=b;return h}};c.Box2DUtils=Box2DUtils})(boxledjs);
Object.equals=function(c,b){if(c===b)return!0;if(!(c instanceof Object)||!(b instanceof Object)||c.constructor!==b.constructor)return!1;for(var a in c)if(c.hasOwnProperty(a)&&(!b.hasOwnProperty(a)||c[a]!==b[a]&&("object"!==typeof c[a]||!Object.equals(c[a],b[a]))))return!1;for(a in b)if(b.hasOwnProperty(a)&&!c.hasOwnProperty(a))return!1;return!0};var Box2D=Box2D||{};Box2D.Ext=Box2D.Ext||{};
(function(c){function b(a,e,h,b,g,c){var k;if(k=(h+0.1>=a&&a>=g-0.1||h-0.1<=a&&a<=g+0.1)&&(b+0.1>=e&&e>=c-0.1||b-0.1<=e&&e<=c+0.1))0.1<g-h||0.1<h-g?(a=(c-b)/(g-h)*(a-h)+b,k=0.1>(a>e?a-e:e-a)):k=0.1>a-h||0.1>h-a;return k}function a(a,e,h,b){return 0.1>(h>=a?h-a:a-h)&&0.1>(b>=e?b-e:e-b)}function e(){throw Error("A problem has occurred. Use the Validate() method to see where the problem is.");}c.b2Separator={Separate:function(f,d,h,l){l=l||32;var g,c=h.length,k,n,m=[];for(g=0;g<c;g++)m.push(new Box2D.Common.Math.b2Vec2(h[g].x/
l,h[g].y/l));var p,r,q,t,z,x,B,y,u,s,v,w,A,E;l=[];h=[];for(h.push(m);h.length;){g=h[0];c=g.length;E=!0;for(p=0;p<c;p++)if(m=p,B=p<c-1?p+1:p+1-c,q=p<c-2?p+2:p+2-c,y=g[m],u=g[B],q=g[q],q=y.x*u.y+u.x*q.y+q.x*y.y-y.y*u.x-u.y*q.x-q.y*y.x,0>q){E=!1;x=Number.MAX_VALUE;for(r=0;r<c;r++)if(r!=m&&r!=B){p=r;q=r<c-1?r+1:0;s=g[p];v=g[q];t=y.x;z=y.y;var G=u.x,H=u.y;w=s.x;s=s.y;var I=v.x;v=v.y;var C=G-t,D=H-z,J=I-w,K=v-s,F=void 0,F=(J*(s-z)-K*(w-t))/(D*J-C*K),C=t+F*C,D=z+F*D;t=b(G,H,t,z,C,D);w=b(C,D,w,s,I,v);if(w=
t&&w?new Box2D.Common.Math.b2Vec2(C,D):null)t=u.x-w.x,z=u.y-w.y,t=t*t+z*z,t<x&&(n=p,k=q,A=w,x=t)}x==Number.MAX_VALUE&&e();r=[];x=[];p=n;q=k;s=g[p];v=g[q];a(A.x,A.y,v.x,v.y)||r.push(A);a(A.x,A.y,s.x,s.y)||x.push(A);n=-1;for(k=m;;){if(k!=q)r.push(g[k]);else{(0>n||n>=c)&&e();b(v.x,v.y,g[n].x,g[n].y,y.x,y.y)||r.push(g[k]);break}n=k;0>k-1?k=c-1:k--}r=r.reverse();n=-1;for(k=B;;){if(k!=p)x.push(g[k]);else{(0>n||n>=c)&&e();k==p&&!b(s.x,s.y,g[n].x,g[n].y,u.x,u.y)&&x.push(g[k]);break}n=k;k+1>c-1?k=0:k++}h.push(r,
x);h.shift();break}E&&l.push(h.shift())}c=l.length;for(g=0;g<c;g++){h=[];m=l[g];n=m.length;for(k=0;k<n;k++)h.push(new Box2D.Common.Math.b2Vec2(m[k].x,m[k].y));k=new Box2D.Collision.Shapes.b2PolygonShape;k.SetAsArray(h);d.shape=k;f.CreateFixture(d)}},Validate:function(a){var e,h=a.length,c,g,j,k,n,m=0,p,r=!1;for(e=0;e<h;e++){j=e<h-1?e+1:0;k=0<e?e-1:h-1;p=!1;for(c=0;c<h;c++)if(c!=e&&c!=j&&(p||(n=a[e].x*a[j].y+a[j].x*a[c].y+a[c].x*a[e].y-a[e].y*a[j].x-a[j].y*a[c].x-a[c].y*a[e].x,0<n&&(p=!0)),c!=k)){g=
c<h-1?c+1:0;var q=a[e].x,t=a[e].y,z=a[j].x,x=a[j].y;n=a[c].x;var B=a[c].y,y=a[g].x;g=a[g].y;var u=z-q,s=x-t,v=y-n,w=g-B,A=void 0,A=(v*(B-t)-w*(n-q))/(s*v-u*w),u=q+A*u,s=t+A*s,q=b(u,s,q,t,z,x);n=b(u,s,n,B,y,g);n=q&&n?new Box2D.Common.Math.b2Vec2(u,s):null;n&&(m=1)}p||(r=!0)}r&&(m=1==m?3:2);return m}}})(Box2D.Ext);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new Box2D.Dynamics.b2ContactListener;var a=b.prototype;a.BeginContact=function(a){var f=a.GetFixtureA(),d=a.GetFixtureB();this.__BeginContactOrdered(f,d,a);this.__BeginContactOrdered(d,f,a)};a.__BeginContactOrdered=function(a,f,d){var h=a.GetBody().GetUserData(),b=f.GetBody().GetUserData();h&&h.objectData&&(h=h.objectData);b&&b.objectData&&(b=b.objectData);this.__applyForceField(a,f,h,b,1,1,d);this.__applyImpulse(a,f,h,b,d);this.__handleCustomEvents(a,f,h,b,
d,"beginContact")};a.EndContact=function(a){var f=a.GetFixtureA();a=a.GetFixtureB();this.__EndContactOrdered(f,a);this.__EndContactOrdered(a,f)};a.__EndContactOrdered=function(a,f,d){var h=a.GetBody().GetUserData(),b=f.GetBody().GetUserData();h&&h.objectData&&(h=h.objectData);b&&b.objectData&&(b=b.objectData);this.__applyForceField(a,f,h,b,-1,0,d);this.__handleCustomEvents(a,f,h,b,d,"endContact")};a.__applyForceField=function(a,f,d,b,c,g){if(d&&d.properties&&(d.properties.forceX||d.properties.forceY))if((d.properties.forceX||
d.properties.forceY)&&!f.IsSensor()){b=parseFloat(d.properties.forceX)||0;var j=parseFloat(d.properties.forceY)||0,k=f.GetBody();k.o_fieldForceX=k.o_fieldForceX+b*c||b*(g||0);k.o_fieldForceY=k.o_fieldForceY+j*c||j*(g||0)}if(d&&d.properties&&(d.properties.force||void 0!=d.properties.gravityFactor)&&!f.IsSensor())k=f.GetBody(),k.o_dynamicForceFields=k.o_dynamicForceFields||[],1==c?k.o_dynamicForceFields.push(a.GetBody()):k.o_dynamicForceFields.splice(k.o_dynamicForceFields.indexOf(a.GetBody()),1)};
a.__applyImpulse=function(a,f,d,b,c){if(d&&d.properties&&(d.properties.impulseX||d.properties.impulseY||d.properties.impulse)){if((d.properties.impulseX||d.properties.impulseY)&&!f.IsSensor()){b=parseFloat(d.properties.impulseX)||0;var g=parseFloat(d.properties.impulseY)||0,j=f.GetBody();j.ApplyImpulse(new Box2D.Common.Math.b2Vec2(b||0,g||0),j.GetWorldCenter())}d.properties.impulse&&!f.IsSensor()&&(d=parseFloat(d.properties.impulse)||0,a=a.GetBody(),f=f.GetBody(),b=new Box2D.Common.Math.b2Vec2(f.GetWorldCenter().x,
f.GetWorldCenter().y),b.Subtract(a.GetWorldCenter()),b.Normalize(),b.Multiply(d),f.ApplyImpulse(b,f.GetWorldPoint(c.GetManifold().m_localPoint)))}};a.__handleCustomEvents=function(a,f,d,b,c,g){d&&(d.properties&&d.properties.event)&&(a={type:d.properties.event,detail:{status:g,targetFixture:a,triggeringFixture:f}},d.eventsToDispatch=d.eventsToDispatch||[],d.eventsToDispatch.push(a))};a.PreSolve=function(){};c.BoxledJSContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(){}b.prototype=new boxledjs.BoxledJSContactListener;var a=b.prototype;a.super_BeginContact=a.BeginContact;a.BeginContact=function(a){this.super_BeginContact(a);this.__HandleContact(a,1)};a.super_EndContact=a.EndContact;a.EndContact=function(a){this.super_EndContact(a);this.__HandleContact(a,-1)};a.__HandleContact=function(a,f){var d=a.GetFixtureA(),b=a.GetFixtureB(),c=d.IsSensor()?d:b.IsSensor()?b:null;if(c){d=d!=c?d:b;if((b=d.GetBody().GetUserData())&&b.objectData)b=b.objectData;
c.GetUserData();if(c.GetUserData()&&c.GetUserData().sensorPosition){var g=c.GetBody().GetUserData(),j=d.GetBody().GetUserData();if(j&&j.onContact)j.onContact(g,1==f);var k=c.GetUserData()&&c.GetUserData().sensorPosition;b&&b.properties&&b.properties.noBottomCollision&&("left"==k||"right"==k)||(d.IsSensor()||g==c||g==j)||g&&(g.bxd&&g.bxd.sensors&&k)&&(1==f&&-1==g.bxd.sensors[k].indexOf(d.GetBody())?g.bxd.sensors[k].push(d.GetBody()):-1==f&&0<=g.bxd.sensors[k].indexOf(d.GetBody())&&g.bxd.sensors[k].splice(g.bxd.sensors[k].indexOf(d.GetBody()),
1))}}};a._ea=[];a.super_PreSolve=a.PreSolve;a.PreSolve=function(a,f){this.super_PreSolve(a,f);var d=a.GetFixtureA(),b=a.GetFixtureB(),c,g,j;c=d.GetBody().GetUserData();g=b.GetBody().GetUserData();c&&c.objectData&&(c=c.objectData);g&&g.objectData&&(g=g.objectData);j=c.ignoreCollisionsWith||c.properties.ignoreCollisionsWith||this._ea;var k=g.ignoreCollisionsWith||g.properties.ignoreCollisionsWith||this._ea;if(!1===c.visible||!1===g.visible||0<=j.indexOf(g.subType)||0<=j.indexOf(g.type)||0<=k.indexOf(c.subType)||
0<=k.indexOf(c.type))a.SetEnabled(!1);else if(c&&c.properties&&c.properties.noBottomCollision||g&&g.properties&&g.properties.noBottomCollision)d.GetBody().GetDefinition().type==Box2D.Dynamics.b2Body.b2_staticBody?(g=b.GetBody().m_linearVelocity.y,j=b.GetBody().m_invMass,c=b.GetAABB(),d=d.GetAABB()):(g=d.GetBody().m_linearVelocity.y,j=d.GetBody().m_invMass,c=d.GetAABB(),d=b.GetAABB()),b=Math.abs(d.lowerBound.y-d.upperBound.y),g=g*j/Box2D.Dynamics.b2World.s_timestep2.velocityIterations,(c.upperBound.y-
g>d.upperBound.y&&c.upperBound.y>d.upperBound.y||c.upperBound.y-g>d.lowerBound.y+b/25&&c.upperBound.y>d.lowerBound.y+b/25)&&a.SetEnabled(!1)};c.PlatformerContactListener=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,e){this.initialize(a,e)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,e){this.Container_init();this.data=a;this.properties=a.properties;this.objects={};this.map=e;this.reset()};b.prototype.reset=function(){this.initObjects()};b.prototype.destroy=function(){var a,e;this.parent&&this.parent.removeChild(this);for(a in this.objects)e=this.objects[a],e.destroy&&e.destroy(),e.parent&&(e.parent.removeChild(e),
delete this.objects[a]);delete this.objects;for(a in this.children)e=this.children[a],e.destroy&&e.destroy();this.removeAllChildren()};b.prototype.onTick=function(){!1!==this.zSorting&&this.sortChildren(this.compareChildY)};b.prototype.compareChildY=function(a,e){return a.y<e.y?-1:a.y>e.y?1:0};b.prototype.initObjects=function(){var a,e,f,d;a=0;for(e=this.data.objects.length;a<e;a++){f=this.data.objects[a];if(f.type&&""!=f.type)d=b.makeObjectFromData(f);else if(this.map.b2dWorld)d=boxledjs.Box2DUtils.makeB2DBodyFromData(f,
this.map.b2dWorld);else{d="Couldn't create b2Body from objectData, because map.b2dWorld is "+this.map.b2dWorld;console.warn&&console.warn(d,f);continue}this.initObject(d,f)}};b.prototype.initObject=function(a,e){var f=!1;try{a.isVisible&&this.addChild(a)}catch(b){}try{if(a.bxd){var c=this.map.b2dWorld.CreateBody(a.bxd.bodyDef);c.CreateFixture(a.bxd.fixDef);a.bxd.sensorsDef&&(a.bxd.sensorsDef.bottom&&c.CreateFixture(a.bxd.sensorsDef.bottom).SetUserData({object:a,sensorPosition:"bottom"}),a.bxd.sensorsDef.top&&
c.CreateFixture(a.bxd.sensorsDef.top).SetUserData({object:a,sensorPosition:"top"}),a.bxd.sensorsDef.right&&c.CreateFixture(a.bxd.sensorsDef.right).SetUserData({object:a,sensorPosition:"right"}),a.bxd.sensorsDef.left&&c.CreateFixture(a.bxd.sensorsDef.left).SetUserData({object:a,sensorPosition:"left"}),a.bxd.sensorsDef.tr&&c.CreateFixture(a.bxd.sensorsDef.tr).SetUserData({object:a,sensorPosition:"tr"}),a.bxd.sensorsDef.br&&c.CreateFixture(a.bxd.sensorsDef.br).SetUserData({object:a,sensorPosition:"br"}),
a.bxd.sensorsDef.bl&&c.CreateFixture(a.bxd.sensorsDef.bl).SetUserData({object:a,sensorPosition:"bl"}),a.bxd.sensorsDef.tl&&c.CreateFixture(a.bxd.sensorsDef.tl).SetUserData({object:a,sensorPosition:"tl"}));c.SetPositionAndAngle(new Box2D.Common.Math.b2Vec2(a.x/boxledjs.Const.scale,a.y/boxledjs.Const.scale),a.rotation*Math.PI/180);a.bxd.sensorsDef=void 0;a.bxd.body=c;c.SetUserData(a);f=!0}}catch(l){}a.layer=this;e&&(e.name&&""!=e.name)&&(this.objects[e.name]=a,this.map.objects[e.name]=a);e&&(e.group&&
""!=e.group)&&(this.map.objectGroups[e.group]=this.map.objectGroups[e.group]||[],this.map.objectGroups[e.group].push(a));if(f&&a.onBodyCreated)a.onBodyCreated(c)};b.makeObjectFromData=function(a){var e,b,d,c=a.properties;e=boxledjs.Utils.getDefinitionByName(a.type||c.type||c.classDefinition);c.parameter&&""!=c.parameter&&(b="string"==typeof c.parameter?JSON.parse(c.parameter):c.parameter,"object"==typeof b&&(d=boxledjs.Utils.applyConstruct(e,b)));d=d||new e;for(var l in c)"classDefinition"!=l&&"parameter"!=
l&&(d[l]=c[l]);d.x=a.x;d.y=a.y;if(void 0!=a.scaleX||void 0!=c.scaleX)d.scaleX=a.scaleX||c.scaleX;if(void 0!=a.scaleY||void 0!=c.scaleY)d.scaleY=a.scaleY||c.scaleY;d.rotation=a.rotation;return d};c.ObjectLayer=b})(boxledjs);boxledjs=boxledjs||{};
(function(c){function b(a,e){this.initialize(a,e)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,e){this.Container_init();this.data=a;this.properties=a.properties;this.map=e;this.reset()};b.prototype.reset=function(){this.x=this.data.x;this.y=this.data.y;this.visible=this.data.visible;this.alpha=void 0!=this.data.opacity?parseFloat(this.data.opacity):1;this.numTilesX=this.data.width;this.numTilesY=this.data.height;if(this.isCollisionLayer=
this.properties&&this.properties.collisionLayer&&"false"!=this.properties.collisionLayer)this.colTilesToCheck=[],this.colTileGroups=[];this.pathfinding={};this.drawTiles();this.data.properties&&"false"!==this.data.properties.cached&&this.cache(0,0,this.map.data.tilewidth*this.numTilesX,this.map.data.tileheight*this.numTilesY);this.isCollisionLayer&&this.map.b2dWorld&&this.calculateCollisionShapes()};b.prototype.destroy=function(){var a,e;this.data.properties&&"false"!==this.data.properties.cached&&
this.uncache();this.parent&&this.parent.removeChild(this);for(a in this.objects)e=this.objects[a],e.destroy&&e.destroy(),e.parent&&(e.parent.removeChild(e),delete this.objects[a]);delete this.objects;for(a in this.children)e=this.children[a],e.destroy&&e.destroy();this.pathfinding&&this.pathfinding.graph&&(this.pathfinding.graph.destroy(),delete this.pathfinding.graph,delete this.pathfinding);this.removeAllChildren()};b.prototype.drawTiles=function(){var a=this.data.data,e,b,d,c,l,g,j,k=[],n;this.tileObjects=
[];for(e=0;e<this.numTilesX;e++){n=[];for(b=0;b<this.numTilesY;b++)d=b*this.numTilesX+e,c=a[d],j=this.map.getTileProperties(c),0!=c&&void 0!=c&&(j&&j.type&&""!=j.type?(l={},l.properties=j,l.x=e,l.y=b,g=boxledjs.ObjectLayer.makeObjectFromData(l),g.regX=this.map.data.tilewidth/2,g.regY=this.map.data.tileheight/2):(l=this.map.getTileById(c),g=new createjs.Bitmap(l.image),g.sourceRect=l.rect,g.regX=0.5*this.map.data.tilewidth,g.regY=0.5*this.map.data.tileheight),g.x=e*this.map.data.tilewidth+0.5*this.map.data.tilewidth,
g.y=b*this.map.data.tileheight+0.5*this.map.data.tileheight,g.properties=j,this.addChild(g),this.tileObjects[d]=g),this.isCollisionLayer?(this.colTilesToCheck[d]=c,d=!Box2DUtils.isTileCollideable(j,c)):d=!j||"false"!=j.passable,n.push(d?GraphNodeType.OPEN:GraphNodeType.WALL);k.push(n)}this.pathfinding.graph=new Graph(k)};b.prototype.calculateCollisionShapes=function(){var a,e,b,c,h=this.map.data.tilewidth,l=this.map.data.tileheight;for(b=0;b<this.numTilesY;b++)for(e=0;e<this.numTilesX;e++)a=b*this.numTilesX+
e,a=this.colTilesToCheck[a],void 0!=a&&0!=a&&(this.colTileGroups.push({tiles:[]}),this.findNextCollisionShapeTile(e,b));a=0;for(c=this.colTileGroups.length;a<c;a++){var g=this.colTileGroups[a],j=g.tiles;e=j[0].x;b=j[0].y;j=j[j.length-1].x-e+1;g=this.map.getTileProperties(g.tileid)||{};g={x:e*h,y:b*l,width:j*h,height:1*l,properties:g};j=boxledjs.Box2DUtils.makeB2DBodyFromData(g,this.map.b2dWorld);if((e=this.tileObjects[b*this.numTilesX+e])&&e.properties&&e.properties.type){if(j.SetUserData(e),e.bxd=
e.bxd||{},e.bxd.body=j,Box2DUtils.injectOnTick(e),e.onBodyCreated)e.onBodyCreated(j)}else j.SetUserData(g)}};b.prototype.findNextCollisionShapeTile=function(a,e){a=a||0;e=e||0;var b,c,h;b=e*this.numTilesX+a;c=this.colTilesToCheck[b];if(void 0!=c&&0!=c&&(h=this.colTileGroups[this.colTileGroups.length-1],h.tileid=h.tileid||c,Object.equals(this.map.getTileProperties(c),this.map.getTileProperties(h.tileid))&&(!h.tiles.length||!(this.map.getTileProperties(c)&&void 0!=this.map.getTileProperties(c).type))))h.tiles.push({x:a,
y:e,tileid:c}),this.colTilesToCheck[b]=void 0,this.findNextCollisionShapeTile(a+1,e)};c.TileLayer=b})(boxledjs);boxledjs=boxledjs||{};boxledjs.Const={};boxledjs.Const.scale=32;
(function(c){function b(a,e){this.initialize(a,e)}b.prototype=new createjs.Container;b.prototype.Container_init=b.prototype.initialize;b.prototype.initialize=function(a,e){this.Container_init();this.b2dWorld=e;this.data=a;this.reset()};b.prototype.reset=function(){this.viewPort={};this.layers={};this.objects={};this.objectGroups={};this.pathfinding={};if(!1!==this.b2dWorld&&void 0===this.b2dWorld){boxledjs.Const.scale=parseFloat(this.data.properties.box2dScale)||boxledjs.Const.scale;this.b2dWorld=
new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(parseFloat(this.data.properties.forceX)||0,parseFloat(this.data.properties.forceY)||20),!0);var a=new boxledjs.PlatformerContactListener;this.b2dWorld.SetContactListener(a)}this.firstTick=!1;this.generateTileSets()};b.prototype.destroy=function(){var a,e;if(this.b2dWorld){for(e=this.b2dWorld.GetBodyList();e;){var b=e;e=e.GetNext();this.b2dWorld.DestroyBody(b)}delete this.b2dWorld}this.parent&&this.parent.removeChild(this);for(a in this.objects)e=
this.objects[a],e.destroy&&e.destroy(),e.parent&&(e.parent.removeChild(e),delete this.objects[a]);delete this.objects;for(a in this.layers)e=this.layers[a],e.destroy();delete this.layers;this.removeAllChildren();return!0};b.prototype.onTick=function(){!this._firstTick&&this._onFirstTick();this.centerObject&&this.centerTo(this.centerObject)};b.prototype._onFirstTick=function(){var a=boxledjs.Utils.getStage(this).canvas;void 0==this.viewPort.width&&(this.viewPort.width=a.width);void 0==this.viewPort.height&&
(this.viewPort.height=a.height);!this.b2dDebugDraw&&this.setupDebugDraw(a);this._firstTick=!0};b.prototype.update=function(a){if(this.initialized&&!1!==this.b2dWorld&&void 0!==this.b2dWorld){for(var b=this.b2dWorld.GetBodyList();b;){var c=b.GetUserData(),d=c?c.properties:{};if(c&&c.eventsToDispatch)for(;c.eventsToDispatch.length;){var h=c.eventsToDispatch.pop();this.dispatchEvent(h)}if(!d||!0!=d.ignoreForces){if(b.o_fieldForceX||b.o_fieldForceY)b.ApplyForce(new Box2D.Common.Math.b2Vec2((b.o_fieldForceX||
0)*b.GetMass(),(b.o_fieldForceY||0)*b.GetMass()),b.GetWorldCenter());if(b.o_dynamicForceFields&&b.o_dynamicForceFields.length){for(var c=[],l,d=0,h=b.o_dynamicForceFields.length;d<h;d++){var g=b.o_dynamicForceFields[d],j=parseFloat(g.GetUserData().properties.force)||0,k=new Box2D.Common.Math.b2Vec2(b.GetWorldCenter().x,b.GetWorldCenter().y);k.Subtract(g.GetWorldCenter());k.Normalize();k.Multiply(j);k.Multiply(b.GetMass());!isNaN(k.x)&&!isNaN(k.y)&&b.ApplyForce(k,b.GetWorldCenter());void 0!=g.GetUserData().properties.gravityFactor&&
c.push(parseFloat(g.GetUserData().properties.gravityFactor))}d=0;for(h=c.length;d<h;d++)l=l+c[d]||c[d];isNaN(l)||(d=this.b2dWorld.GetGravity().GetNegative(),d.Multiply(1-l/c.length),d.Multiply(b.GetMass()),b.ApplyForce(d,b.GetWorldCenter()))}}b=b.GetNext()}this.b2dWorld&&this.b2dWorld.Step((a||30)/1E3,10,10);this.b2dWorld&&this.b2dWorld.ClearForces()}};b.prototype.setupDebugDraw=function(a){if(!this.b2dWorld)return null;this.b2dDebugDraw=new Box2D.Dynamics.b2DebugDraw;this.b2dDebugDraw.SetSprite(a.getContext("2d"));
this.b2dDebugDraw.SetDrawScale(boxledjs.Const.scale);this.b2dDebugDraw.SetFillAlpha(0.35);this.b2dDebugDraw.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);this.b2dWorld.SetDebugDraw(this.b2dDebugDraw);return this.b2dDebugDraw};b.prototype.drawDebugData=function(a){this.b2dWorld&&(a=a||1,this.b2dDebugDraw.SetFillAlpha(0.35*a),this.b2dDebugDraw.SetAlpha(1*a),this.b2dDebugDraw.GetSprite().save(),this.b2dDebugDraw.GetSprite().scale(this.scaleX,this.scaleY),this.b2dDebugDraw.GetSprite().translate(-this.regX+
this.x/this.scaleX,-this.regY+this.y/this.scaleY),this.b2dWorld.DrawDebugData(),this.b2dDebugDraw.GetSprite().restore())};b.prototype.setupLayers=function(){var a,b,c,d,h=[];a=0;for(b=this.data.layers.length;a<b;a++)if(c=this.data.layers[a],"tilelayer"==c.type){d=new boxledjs.TileLayer(c,this);this.addChild(d);for(var l=d.pathfinding.graph.input,g=0,j=l.length;g<j;g++){var k=l[g],n=h[g]||[];h[g]=n;for(var m=0,p=k.length;m<p;m++)n[m]=(n[m]||1)&k[m]}c.name&&""!=c.name&&(this.layers[c.name]=d)}a=0;for(b=
this.data.layers.length;a<b;a++)c=this.data.layers[a],"objectgroup"==c.type&&(d=new boxledjs.ObjectLayer(c,this),this.addChild(d),c.name&&""!=c.name&&(this.layers[c.name]=d));this.pathfinding.graph=new Graph(h)};b.prototype.centerTo=function(a){"string"==typeof a&&(a=this.objects[a]);if(a&&void 0!=a){var b,c;a.GetPosition?(c=a.GetPosition(),b=c.x*boxledjs.Const.scale,c=c.y*boxledjs.Const.scale):void 0!=a.x&&void 0!=a.y&&(b=a.x,c=a.y);if(!(void 0==b||void 0==c)){a=this.viewPort.width||0;var d=this.viewPort.height||
0;this.regX=b;this.regY=c;this.x=a/2;this.y=d/2}}};b.prototype.calculatePath=function(a,b,c,d){var h=this.pathfinding.graph.nodes;a=h[a.x][a.y];b=h[b.x][b.y];if((a=astar.search(h,a,b,c))&&a.length&&!0===d){d=!1;for(var l,g=0;g<a.length-2;g++)for(d=!1;!d&&a[g+2];)b=a[g].x-a[g+1].x,c=a[g].y-a[g+1].y,h=a[g].x-a[g+2].x,l=a[g].y-a[g+2].y,0==h&&0==b||0==l&&0==c?a.splice(g+1,1):d=!0}return a};b.prototype.generateTileSets=function(){this.tilesets=[];this.tileproperties={};for(var a=this.loadedSets=0,c=this.data.tilesets.length;a<
c;a++){var f=b.convertTileSetToSpriteSheet(this.data.tilesets[a]);this.tilesets.push(f);for(var d in f.tileproperties){var h=f.tileproperties[d],l;for(l in h){var g=h[l];0==g.indexOf("[")&&(h[l]=JSON.parse(g))}this.tileproperties[d]=h}if(f.complete)this.loadedSets++;else{var j=this;f.addEventListener("complete",function(){j.setsLoaded()})}}this.loadedSets==c&&this.setsLoaded()};b.prototype.setsLoaded=function(){this.setsLoaded++;this.loadedSets==this.data.tilesets.length&&(this.setupLayers(),this.initialized=
!0)};b.prototype.getTileById=function(a){a-=1;return this.getSpriteSheetByTileId(a).getFrame(a)};b.prototype.getSpriteSheetByTileId=function(a){a=a||1;var b=this.tilesets,c,d,h,l;c=0;for(d=b.length;c<d;c++)h=b[c],h.firstgid<=a&&0<h.firstgid&&(l=h);return l};b.prototype.getTileProperties=function(a){return this.tileproperties[a-1]};b.convertTileSetToSpriteSheet=function(a){var b={};b.images=[a.image];b.frames={width:a.tilewidth,height:a.tileheight};b=new createjs.SpriteSheet(b);b.firstgid=a.firstgid;
b.tileproperties=a.tileproperties;return b};c.Map=b})(boxledjs);
